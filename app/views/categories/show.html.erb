<div class="container mt-5">
  <div class="row">
    <div class="col-md-6 offset-md-3">
      <h1 class="text-center mb-3" style="font-size: 5.5em;"><%= @category.name %></h1>
      <div class="card border-0 rounded mb-5">
          <div class="mt-3 d-flex justify-content-between">
            <%= link_to "Modifier cette catégorie", edit_category_path(@category), class: 'btn btn-outline-dark' %>
            <%= button_to "Supprimer cette catégorie", @category, method: :delete, class: 'btn btn-outline-dark', data: { confirm: 'Are you sure?' } %>
          </div>
        </div>
      </div>
    </div>
  </div>


  <%= link_to competition_edition_competition_category_inscriptions_path(@competition, @edition_competition, @category), data: { controller: "hover" } do %>
    <div class="card" style="width: 100%; height: 300px; background-image: url('https://source.unsplash.com/random/?applications/300/200'); background-size: cover;" data-action="mouseenter->hover#hover mouseleave->hover#unhover">
      <div class="card-img-overlay d-flex justify-content-center align-items-center" style="background-color: rgba(0, 0, 0, 0.5);">
        <h1 class="card-title text-white" style="font-size: 3em;" data-hover-target="text">Inscriptions (<%= @category.inscriptions.count %>)</h1>
      </div>
    </div>
  <% end %>





<!-- Section Programme Demandé-->
<div class="bg-black text-center py-5 mb-5">
  <h2 class="text-white" style="font-size: 4em; height: 300px;">Programme demandé</h2>
</div>


<div class="d-flex flex-column align-items-center gap-5">
  <!-- Section Oeuvres obligatoires: table "imposed_works" -->
  <div class="col-md-8 border p-3 shadow d-flex flex-column align-items-center">
    <h3 style="font-size: 3em;" class=" px-3 rounded-pill">Oeuvres imposées</h3>
    <% imposed_work = @category.imposed_work %>
    <% if imposed_work.present? %>
      <div class="container p-3">
        <div class="d-flex flex-column">
          <div class="w-100 d-flex justify-content-between">
            <h2 class="text-dark"><%= imposed_work.title %></h2>
            <div class="d-flex gap-2 align-items-center">
              <%= link_to edit_imposed_work_path(imposed_work), class: 'btn p-0' do %>
                <i class="fas fa-edit"></i>
              <% end %>

              <%= button_to imposed_work_path(imposed_work, redirect_path: category_path(@category)), method: :delete, data: { confirm: 'Are you sure?', turbo_confirm: "Are you sure?" }, class: 'btn ' do %>
                <i class="fas fa-trash"></i>
              <% end %>
            </div>
          </div>
          <p class="text-secondary"><%= imposed_work.guidelines %></p>
        </div>
        <div class="d-flex flex-column gap-3">
          <% imposed_work.airs.each do |work| %>
              <div class="card-body d-flex flex-column border px-3 py-1 bg-white">
                <div class="d-flex justify-content-between align-items-start w-100">
                  <h4 class="card-text "><strong><%= work.title %></strong> </h4>
                  <%= button_to air_path(work, redirect_path: category_path(@category)), method: :delete, data: { confirm: 'Are you sure?', turbo_confirm: "Are you sure?" }, class: 'btn btn-light text-dark' do %>
                    <i class="fas fa-close" style="font-size: 0.7em;"></i>
                  <% end %>
                </div>

                <small class="card-text"><strong><%= work.composer %></strong> - <%= work.oeuvre %></small>

                <div class="d-flex justify-content-between align-items-center w-100">
                 <span class="badge rounded-pill text-secondary border text-dark"><%= work.tonality %></span>
                  <% if work.character.present? %><small class="card-text"><%= work.character %></small><% end %>
                  <small class="badge rounded-pill text-secondary border"><i class="fas fa-clock pe-1 text-secondary"></i><%= work.length_minutes %> min </small>
                </div>
              </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <%= link_to 'Add', new_imposed_work_path(category_id: @category.id), class: 'btn btn-primary', data: { toggle: 'modal', target: '#imposedWorkModal' } %>
    <% end %>
  </div>

  <!-- Section Oeuvres à choisir parmi une liste. table "choice_imposed_works" -->
  <div class="col-md-8 border p-3 shadow d-flex flex-column align-items-center">
    <h3 style="font-size: 3em;" class=" px-3 rounded-pill">Oeuvres au choix dans une liste</h3>
    <% if @category.choice_imposed_works.none? %>
      <p>Créez ici une liste d'oeuvres et précisez le nombre que le candidat doit sélectionner. Vous pouvez aussi ajouter des consignes et un titre à cette liste si vous le souhaitez. </p>
    <% end %>
    <% @category.choice_imposed_works.each do |choice_imposed_work| %>

      <div class="container p-3 border border-3 shadow-sm mt-3 bg-white">
        <div class="d-flex flex-column">
          <div class="w-100 d-flex justify-content-between">
            <h2 class="text-dark"><%= choice_imposed_work.title %></h2>
            <div class="d-flex gap-2 align-items-center">

              <%= link_to edit_competition_edition_competition_category_choice_imposed_work_path(@competition, @edition_competition, @category, choice_imposed_work), class: 'btn p-0' do %>
                <i class="fas fa-edit"></i>
              <% end %>

              <%= button_to competition_edition_competition_category_choice_imposed_work_path(@competition, @edition_competition, @category, choice_imposed_work, redirect_path: category_path(@category)), method: :delete, data: { confirm: 'Are you sure?', turbo_confirm: "Are you sure?" }, class: 'btn ' do %>
                <i class="fas fa-trash"></i>
              <% end %>
            </div>
          </div>
        <h4><span class="bg-info rounded-pill p-2">Choisir <%= choice_imposed_work.number_to_select %> oeuvres</span></h4>          <p class="text-secondary"><%= choice_imposed_work.guidelines %></p>
        </div>
        <div class="d-flex flex-column gap-3">
          <% choice_imposed_work.airs.each do |work| %>
              <div class="card-body d-flex flex-column border px-3 py-1" style="border-radius: 8px; background: linear-gradient(to left, white, #fcf8ef);">
                <div class="d-flex justify-content-between align-items-start w-100">
                  <h4 class="card-text "><strong><%= work.title %></strong> </h4>
                  <%= button_to air_path(work, redirect_path: category_path(@category)), method: :delete, data: { confirm: 'Are you sure?', turbo_confirm: "Are you sure?" }, class: 'btn btn-light text-dark' do %>
                    <i class="fas fa-close" style="font-size: 0.7em;"></i>
                  <% end %>
                </div>

                <small class="card-text"><strong><%= work.composer %></strong> - <%= work.oeuvre %></small>

                <div class="d-flex justify-content-between align-items-center w-100">
                 <span class="badge rounded-pill text-secondary border text-dark"><%= work.tonality %></span>
                  <% if work.character.present? %><small class="card-text"><%= work.character %></small><% end %>
                  <small class="badge rounded-pill text-secondary border"><i class="fas fa-clock pe-1 text-secondary"></i><%= work.length_minutes %> min </small>
                </div>
              </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <%= link_to '+ Ajouter une liste à choix multiple', new_competition_edition_competition_category_choice_imposed_work_path(@competition, @edition_competition, @category), class:" btn btn-outline-dark my-3" %>
  </div>

  <!-- Section Œuvres à Contraintes Spécifiques : table "semi_imposed_works"-->

  <div class="col-md-8 border p-3 shadow d-flex flex-column align-items-center">
    <h3 style="font-size: 3em;" class=" px-3 rounded-pill">Oeuvres à contraintes spécifiées</h3>
    <% if @category.semi_imposed_works.none? %>
      <p class="text-muted p-2 padding border border-2 rounded"> <i class="fas fa-circle-info pe-2 "></i>Renseignez ici le programme à choix guidé du candidat. Chaque ligne ajoutée doit comporter un nombre d'oeuvres, et la consigne attenante. Par exemple: <br/> <br/>"Cinq mélodies en langue française (dont deux au moins composées après 1900), à l’exclusion de
      Gabriel Fauré et d’Édouard Lalo..." </p>
    <% end %>
    <% @category.semi_imposed_works.each do |semi_imposed_work| %>
      <div class="card mb-3 shadow-sm w-100 bg-light" style="border-radius: 15px;">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h4 class="card-title mb-0"><%= semi_imposed_work.title %></h4>
          <div class="d-flex gap-3" >
            <%= link_to edit_competition_edition_competition_category_semi_imposed_work_path(@competition, @edition_competition, @category, semi_imposed_work), class: 'btn btn-light text-dark btn-sm' do %>
              <i class="fas fa-edit"></i>
            <% end %>
            <%= button_to competition_edition_competition_category_semi_imposed_work_path(@competition, @edition_competition, @category, semi_imposed_work), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-light text-dark btn-sm' do %>
              <i class="fas fa-trash"></i>
            <% end %>
          </div>
        </div>
        <div class="card-body">
          <p class="card-title text-secondary"><i class="fas fa-feather text-gradient"></i> <%= semi_imposed_work.guidelines %></p>
          <span class="badge bg-primary rounded-pill">
            <%= semi_imposed_work.number %> oeuvres
          </span>
          <span class="badge bg-warning rounded-pill">
            <i class="fas fa-clock"></i><%= semi_imposed_work.max_length_minutes %> minutes max total
          </span>
        </div>
      </div>
    <% end %>
    <button type="button" class="text-white btn btn-dark my-3" data-bs-toggle="modal" data-bs-target="#semiImposedWorkModal">
      + Ajouter
    </button>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="semiImposedWorkModal" tabindex="-1" aria-labelledby="semiImposedWorkModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="semiImposedWorkModalLabel">Ajouter un semi-imposed work</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <%= render "semi_imposed_works/form", semi_imposed_work: @semi_imposed_work %>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Section Programme demandé -->
<div class="bg-dark text-center py-5 my-5" style="height: 200px;">
  <h2 class="text-white" style="font-size: 4em;">Pièces et documents requis </h2>
</div>
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Ajouter un élément requis
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Ajouter un élément requis</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= simple_form_for([@competition, @edition_competition, @category, RequirementItem.new]) do |f| %>
          <%= f.input :title %>
          <%= f.input :type_item, collection: ['YouTube Link', 'Audio File', 'Recommendation Letter', 'File', 'Motivation Essay'], prompt: 'Select a type' %>
          <%= f.input :description_item %>
      </div>
      <div class="modal-footer">
        <%= f.button :submit, class: 'btn btn-primary' %>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
      <% end %>
    </div>
  </div>
</div>

<div class="d-flex gap-3 flex-wrap">
  <% @category.requirement_items.each do |item| %>
    <div class="card bg-dark text-white rounded" style="width: 18rem;">
      <div class="card-body">
        <div class="icon-placeholder mx-auto" style="width: 100px; height: 100px;">
          <%= image_tag "https://source.unsplash.com/random/?#{item.type_item}/300/200", alt: "Photo d'item requis", class: "img-fluid w-100 d-block rounded-circle", style: "object-fit: cover; aspect-ratio: 1 / 1; overflow: hidden; ", loading: 'lazy' %>
        </div>
        <h5 class="card-title"><%= item.title %></h5>
        <p class="card-text text-light"><%= item.description_item %></p>

        <span class="badge bg-warning text-dark rounded-pill border border-success"><%= item.type_item %></span>
      </div>
    </div>
  <% end %>
</div>

<!--Tours section -->
<div class="container mt-5">
  <div class="text-center py-5">
    <h2 style="font-size: 4em;">Tours</h2>
  </div>


  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% @category.tours.each do |tour| %>
      <%= link_to competition_edition_competition_category_tour_path(@competition, @edition_competition, @category, tour), class: "text-decoration-none" do %>
        <div class="col">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h4 class="card-title text-dark font-weight-bold"><%= tour.title %> <%= tour.is_online ? raw('<span class="badge rounded-pill bg-success">En ligne</span>') : ''%> </h4>
              <p class="card-text text-secondary"><i class="fas fa-info-circle"></i> <%= tour.description %></p>
              <p class="card-text">
                <small class="text-muted">
                  <i class="fas fa-calendar-alt"></i> Début: <%= tour.start_date.strftime("%d/%m/%Y") %> à <%= tour.start_time.strftime("%H:%M") %><br>
                  <i class="fas fa-calendar-check"></i> Fin: <%= tour.end_date.strftime("%d/%m/%Y") %> à <%= tour.end_time.strftime("%H:%M") %>
                </small>
              </p>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Button trigger modal -->
  <div class="text-center my-4">
    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addTourModal">
      Ajouter un tour
    </button>
  </div>

  <!-- Modal New Tour-->
  <div class="modal fade" id="addTourModal" tabindex="-1" aria-labelledby="addTourModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addTourModalLabel">Ajouter un tour</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <%= render "tours/form", tour: @tour %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
