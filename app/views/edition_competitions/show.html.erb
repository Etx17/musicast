<div class="container mt-5">
  <div class="row">
    <h1 class="text-center" style="font-size: 5em;"><%=  @edition_competition.annee%></h1>
     <div class="col-md-6">
      <h2 class="text-center mb-5 text-dark" style="font-size: 4em;">Edition</h2>
      <div class="card border-0 shadow-sm rounded bg-grey">
        <div class="card-body">
          <div class="d-flex flex-column mb-1">
            <button type="button" class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#publishModal" <%= (@edition_competition.categories.none? || @edition_competition.categories.any? { |c| c.tours.none? }) ? 'disabled' : '' %>>
              Prêt à publier
            </button>
            <small class="text-secondary">Vous pouvez publier après avoir configuré au moins un tour sur chaque catégorie</small>
          </div>
          <%= render @edition_competition %>
          <div class="mt-3 d-flex justify-content-between">
          </div>
        </div>
      </div>

      <div class="mt-3 d-flex justify-content-between">
        </div>

        <div class="modal fade" id="publishModal" tabindex="-1" aria-labelledby="publishModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="publishModalLabel">Confirmation de publication</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                Êtes-vous sûr de vouloir publier maintenant ? Une fois publiée, vous ne pourrez plus la modifier. Assurez vous que vous avez bien rempli comme vous le souhait
                <ul>
                <% @edition_competition.categories&.each do |category| %>
                  <%= link_to organism_competition_edition_competition_category_path(@organism, @competition, @edition_competition, category), target: "_blank", rel: "noopener noreferrer" do %>
                    <li><%= category.name %></li>
                  <% end %>
                <% end %>
                </ul>
              </div>
              <div class="modal-footer">
                <%= simple_form_for [@organism, @competition, @edition_competition] do |f| %>
                  <div class="d-flex gap-2 pb-2">
                    <%= check_box_tag 'confirm_publish', '1', false, class: "form-check-input", required: true %>
                    <label class="form-check-label" for="confirm_publish">
                      J'ai revu ma compétition et je confirme les informations ci dessus. Je comprends que je ne pourrais plus modifier les catégories (leurs règles, programme demandé, etc...) une fois publiées.
                    </label>
                  </div>
                  <%= f.hidden_field :status, value: "published" %>
                  <%= f.submit "Publier", class: "btn btn-success", data: {turbo_confirm: "Confirmer ?"} %>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Pas tout de suite</button>
                <% end %>
              </div>
            </div>
          </div>
        </div>
    </div>

    <div class="col-md-6" data-controller="hover">
      <h2 class="text-center text-dark mb-5" style="font-size: 4em;">Categories</h2>

      <%= link_to '+ Ajouter une catégorie', new_organism_competition_edition_competition_category_path(@organism, @competition, @edition_competition), class: "btn btn-#{@edition_competition.categories.any? ? 'outline-dark' : 'success'} w-100 my-4" %>
      <% @categories.each do |category| %>
       <div class="mb-3">
          <!-- image link-->
          <%= link_to organism_competition_edition_competition_category_path(@organism, @competition, @edition_competition, category), data: { controller: "hover" } do %>
            <% if category.photo.attached? %>
              <div class="card position-relative" style="width: 100%; height: 300px; background-image: url('<%= rails_blob_path(category&.photo) %>'); background-size: cover;" data-action="mouseenter->hover#hover mouseleave->hover#unhover">
            <% else %>
              <div class="card position-relative" style="width: 100%; height: 300px; background-image: url('https://source.unsplash.com/random/?opera/300/200'); background-size: cover;" data-action="mouseenter->hover#hover mouseleave->hover#unhover">
            <% end %>
              <div class="card-img-overlay d-flex justify-content-center align-items-center" style="background-color: rgba(0, 0, 0, 0.5);">
                <h2 class="card-title text-white" style="font-size: 3em;" data-hover-target="text"><%= category.name %></h2>
              </div>

              <!-- links -->
              <div class="d-flex justify-content-between mb-1 position-absolute top-0 start-0 p-3 w-100">
                <%= link_to 'Configurer la catégorie', organism_competition_edition_competition_category_path(@organism, @competition, @edition_competition, category), class: "btn btn-success" %>
                <%= link_to "Candidatures (#{category.inscriptions.where(status: 'in_review').count})", organism_competition_edition_competition_category_inscriptions_path(@organism, @competition, @edition_competition, category), class: "btn btn-light" %>
                <%= button_to "Supprimer", organism_competition_edition_competition_category_path(@organism, @competition, @edition_competition, category), class: "btn", style: "background-color: #FFCCCC;", data: {turbo_confirm: "Êtes-vous sûr de vouloir supprimer cette catégorie ?"}, method: :delete %>
              </div>
            </div>
          <% end %>
        </div>


      <% end %>


    </div>



  </div>
</div>
