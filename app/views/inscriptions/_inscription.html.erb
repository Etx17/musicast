<div id="<%= dom_id inscription %>">

  <div class="row">
    <h2 class='text-center mt-3'>CANDIDATURE</h2>
    <h3 class='text-center mb-3'><%=  link_to inscription.candidat.first_name, candidat_path(inscription.candidat) %></h3>
    <div class="col">
      <div class="card shadow-sm mb-3 bg-light">
        <div class="card-body d-flex flex-column align-items-start">
          <h5>Détails de l'inscription</h5>
          <p><%= inscription.category.edition_competition.competition.nom_concours %> - <small><%= inscription.category.name %></small></p>
          <p>Du: <%= inscription.category.edition_competition.start_date %> au <%= inscription.category.edition_competition.end_date %></p>
          <p><%= inscription.category.edition_competition.address.line1 %> - <%= inscription.category.edition_competition.address.city %></p>

          <span class=" mx-auto badge rounded-pill <%= inscription.draft? ? 'text-secondary border border-secondary bg-grey' : inscription.in_review? ? 'text-info border border-info bg-info-secondary' : inscription.accepted? ? 'text-success border-success bg-success-secondary' : 'text-danger border-danger bg-danger-secondary' %>">
            <i class="fas fa-circle small"></i> <%= inscription.status&.capitalize %>
          </span>
          <!-- Rediriger vers le paiement si ca n'est pas encore fait -->
          <% unless current_user.organisateur %>
            <% if inscription.draft? %>
              <div class="card shadow-sm mb-3 bg-light">
                <div class="card-body d-flex flex-column align-items-start">
                  <h5>Paiement</h5>
                  <p class="text-secondary"> Vous n'avez pas encore payé votre inscription</p>
                  <%= form_tag inscription_orders_path do %>
                    <%= hidden_field_tag :inscription_id, inscription.id %>
                    <%= submit_tag 'Payer', class: 'btn btn-dark' %>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>

      <div class="card p-3 shadow-sm bg-light">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3 class="mb-0">Dossier</h3>
          <%= link_to  edit_inscription_path(inscription), class: 'btn btn-outline-dark w-50'  do %>
            <div class="d-flex align-items-center justify-content-center">
              <i class="fas fa-edit me-2"></i>
              <span>Modifier</span>
            </div>
          <% end %>
        </div>
        <% if inscription.inscription_item_requirements.none? %>
          <p class="text-secondary"> Il n'y a rien ici pour l'instant</p>
        <% end %>
        <%# items requirements %>
        <% inscription.inscription_item_requirements&.each do |item| %>
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title text-muted"><%= item.requirement_item&.title %></h5>
              <p><small class="text-muted"><%= item.requirement_item&.type_item %></small></p>
              <% if item&.submitted_content.present? && item.submitted_content.to_s.start_with?('http') %>
                <div class="embed-responsive embed-responsive-16by9">
                  <iframe class="embed-responsive-item" src="<%= item.submitted_content %>?rel=0" allowfullscreen></iframe>
                </div>
              <% end %>
              <% if item&.submitted_file.attached? %>
                <div class="d-flex flex-column">
                <embed src="<%= url_for(item.submitted_file) %>" width="500" height="375" type="application/pdf">
                <%= link_to 'Voir', url_for(item.submitted_file), target: "_blank" %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="card card-body shadow-sm mb-3 bg-light">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3>Liste d'airs</h3>
          <%= link_to  edit_inscription_path(inscription), class: 'btn btn-outline-dark w-50'  do %>
            <div class="d-flex align-items-center justify-content-center">
              <i class="fas fa-edit me-2"></i>
              <span>Modifier</span>
            </div>
          <% end %>
        </div>
        <% inscription.choice_imposed_work_airs.includes(:choice_imposed_work).map(&:choice_imposed_work).uniq.each do |choice_imposed_work| %>
          <div class="card shadow-sm mb-3 bg-light-grey">
            <div class="card-body">
              <h4 class="card-title"><%= choice_imposed_work.title %></h4>
              <ul class="list-group list-group-flush">
                <% inscription.choice_imposed_work_airs.where(choice_imposed_work: choice_imposed_work).each do |choice_imposed_work_air| %>
                  <li class="list-group-item bg-light"><%= choice_imposed_work_air.air.title %></li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>

        <% inscription.semi_imposed_work_airs&.includes(:semi_imposed_work).map(&:semi_imposed_work).uniq.each do |semi_imposed_work| %>
          <div class="card shadow-sm mb-3 bg-light-grey">
            <div class="card-body">
              <h4 class="card-title"><%= semi_imposed_work.title %></h4>
              <ul class="list-group list-group-flush">
                <% inscription.semi_imposed_work_airs.where(semi_imposed_work: semi_imposed_work).each do |semi_imposed_work_air| %>
                  <li class="list-group-item bg-light"><%= semi_imposed_work_air.air.title %></li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>

        <div class="card shadow-sm mb-3 bg-light-grey">
            <div class="card-body">
              <h4 class="card-title">Airs imposés</h4>
              <ul class="list-group list-group-flush">
                <% inscription.category.imposed_work&.airs&.each do |air| %>
                  <li class="list-group-item bg-light"><%= air.title %></li>
                <% end %>
              </ul>
            </div>
          </div>

      </div>

    </div>

    <div class="col">
      <div class="card p-3 shadow-sm bg-light">
        <h3>Programme tour par tour</h3>
        <% inscription.category.tours.order(:tour_number).each do |tour| %>
          <div class="card bg-light mb-3">
            <div class="card-header d-flex justify-content-between">
              <%= tour.title %>
            </div>
            <div class="card-body">
              <% if tour.tour_requirement.present? %>
                <h5 class="card-title">Tour Requirements:</h5>
                <p class="card-text"><strong>Description:</strong> <%= tour.tour_requirement&.description %></p>
                <p class="card-text"><strong>Number of Works:</strong> <%= tour.tour_requirement&.min_number_of_works %> - <%= tour.tour_requirement&.max_number_of_works %></p>
                <p class="card-text"><strong>Duration:</strong> <%= tour.tour_requirement&.min_duration_minute %> - <%= tour.tour_requirement&.max_duration_minute %> minutes</p>
              <% end %>
              <h5 class="card-title">Performance:</h5>
              <% performance = inscription.performances.find_by(tour: tour) %>
              <% if performance.present? %>
                <ul>
                  <% performance.air_selection&.each do |air_id| %>
                    <% air = Air.find(air_id) %>
                    <li><%= air.title %>, <%= air.length_minutes %> min</li>
                  <% end %>
                </ul>
                <%= link_to 'Edit', edit_inscription_performance_path(inscription, performance, tour_id: tour.id), class: 'btn btn-primary' %>
              <% else %>
                <div class="d-flex flex-column card shadow-sm rounded-4 p-2 gap-2">
                  <small class="bg-grey p-2 rounded-4 text-secondary">
                    <span class="badge rounded-pill text-danger border-danger border"><%= tour.remaining_days %> jours restants</span>
                    <i class="fas fa-info-circle text-secondary px-1"></i>Vous n'avez pas encore créé de programme pour ce tour. Créez le maintenat! Vous pourrez le modifier jusqu'au <%= tour.final_performance_submission_deadline.strftime("%d/%m/%Y") %>.
                  </small>

                  <%= link_to  new_inscription_performance_path(inscription, tour_id: tour.id), class: 'btn btn-dark' do %>
                    <span><i class="fas fa-plus me-2"></i> Créer mon programme</span>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>


    </div>

  </div>
</div>
