<div id="<%= dom_id inscription %>">

  <div class="row">
    <div class="col">
      <div class="card shadow-sm mb-3 bg-light">
        <div class="card-body d-flex flex-column align-items-start">
          <h5>Détails de l'inscription</h5>
          <p><%= inscription.category.edition_competition.competition.nom_concours %> - <small><%= inscription.category.name %></small></p>
          <p>Du: <%= inscription.category.edition_competition.start_date %> au <%= inscription.category.edition_competition.end_date %></p>
          <p><%= inscription.category.edition_competition.address.line1 %> - <%= inscription.category.edition_competition.address.city %></p>

          <span class=" mx-auto badge rounded-pill <%= inscription.draft? ? 'text-secondary border border-secondary bg-grey' : inscription.in_review? ? 'text-info border border-info bg-info-secondary' : inscription.accepted? ? 'text-success border-success bg-success-secondary' : 'text-danger border-danger bg-danger-secondary' %>">
            <i class="fas fa-circle small"></i> <%= inscription.status&.capitalize %>
          </span>
          <!-- Rediriger vers le paiement si ca n'est pas encore fait -->
            <% if inscription.draft? %>
              <div class="card shadow-sm mb-3 bg-light">
                <div class="card-body d-flex flex-column align-items-start">
                  <h5>Paiement</h5>
                  <p class="text-secondary">Vous n'avez pas encore payé votre inscription</p>
                    <%= form_tag inscription_orders_path do %>
                      <%= hidden_field_tag :inscription_id, inscription.id %>
                      <%= submit_tag 'Payer', class: 'btn btn-dark' %>
                    <% end %>
                </div>
              </div>
            <% end %>
        </div>
      </div>

    <%# programme selectionné du candidat %>
      <div class="card card-body shadow-sm mb-3 bg-light">
        <h3>Votre liste d'airs</h3>
        <% inscription.choice_imposed_work_airs.includes(:choice_imposed_work).map(&:choice_imposed_work).uniq.each do |choice_imposed_work| %>
          <div class="card shadow-sm mb-3 bg-light-grey">
            <div class="card-body">
              <h4 class="card-title"><%= choice_imposed_work.title %></h4>
              <ul class="list-group list-group-flush">
                <% inscription.choice_imposed_work_airs.where(choice_imposed_work: choice_imposed_work).each do |choice_imposed_work_air| %>
                  <li class="list-group-item bg-light"><%= choice_imposed_work_air.air.title %></li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>

        <% inscription.semi_imposed_work_airs&.includes(:semi_imposed_work).map(&:semi_imposed_work).uniq.each do |semi_imposed_work| %>
          <div class="card shadow-sm mb-3 bg-light-grey">
            <div class="card-body">
              <h4 class="card-title"><%= semi_imposed_work.title %></h4>
              <ul class="list-group list-group-flush">
                <% inscription.semi_imposed_work_airs.where(semi_imposed_work: semi_imposed_work).each do |semi_imposed_work_air| %>
                  <li class="list-group-item bg-light"><%= semi_imposed_work_air.air.title %></li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>

        <div class="card shadow-sm mb-3 bg-light-grey">
            <div class="card-body">
              <h4 class="card-title">Airs imposés</h4>
              <ul class="list-group list-group-flush">
                <% inscription.category.imposed_work.airs.each do |air| %>
                  <li class="list-group-item bg-light"><%= air.title %></li>
                <% end %>
              </ul>
            </div>
          </div>

      </div>

    </div>

    <div class="col">
      <div class="card p-3 shadow-sm bg-light">
        <h3>Votre dossier</h3>
        <% if inscription.inscription_item_requirements.none? %>
          <p class="text-secondary"> Il n'y a rien ici pour l'instant</p>
        <% end %>
        <%# items requirements %>
        <% inscription.inscription_item_requirements&.each do |item| %>
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5 class="card-title text-muted"><%= item.requirement_item&.title %></h5>
              <p><small class="text-muted"><%= item.requirement_item&.type_item %></small></p>
              <% if item&.submitted_content.present? && item.submitted_content.to_s.start_with?('http') %>
                <div class="embed-responsive embed-responsive-16by9">
                  <iframe class="embed-responsive-item" src="<%= item.submitted_content %>?rel=0" allowfullscreen></iframe>
                </div>
              <% end %>
              <% if item&.submitted_file.attached? %>
                <div class="d-flex flex-column">
                <embed src="<%= url_for(item.submitted_file) %>" width="500" height="375" type="application/pdf">
                <%= link_to 'Voir', url_for(item.submitted_file), target: "_blank" %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="card p-3 shadow-sm bg-light">
        <h3>Programme tour par tour</h3>
        <% inscription.category.tours.each do |tour| %>
          <div class="card card-body bg-grey d-flex flex-column">
            <h4><%= tour.title %></h4>
            <!-- Tour.tour_requirements -->
            <% if tour.tour_requirement.present? %>
              <%= tour.tour_requirement&.description %>
              <%= tour.tour_requirement&.min_number_of_works %>
              <%= tour.tour_requirement&.max_number_of_works %>
              <%= tour.tour_requirement&.min_duration_minute %>
              <%= tour.tour_requirement&.max_duration_minute %>
            <% end %>
            <!-- Et la mettre les airs de la performance -->
            <ul>
              <li>Air 1, Una furtiva lagrima, 3min</li>
              <li>Air 1, Una furtiva lagrima, 8 min</li>
              <li>Air 1, Una furtiva lagrima</li>
            </ul>
          </div>
        <% end %>
      </div>
    </div>

  </div>
</div>
