
<% if performance&.inscription&.candidate_brings_pianist_accompagnateur %>
  <div class="card mb-3 border">
    <div class="card-header bg-light">
      <div class="d-flex align-items-center">
        <%= image_tag 'icons/piano.png', alt: t('inscriptions.inscription.piano'), width: 30, class: "me-2" %>
        <h6 class="mb-0"><%= t('inscriptions.inscription.accompanying_pianist') %></h6>
      </div>
    </div>
    <div class="card-body py-2">
      <div class="row align-items-center">
        <div class="col-md-6">
          <p class="mb-1 fw-bold"><%= performance.inscription.candidate_brings_pianist_accompagnateur_full_name %></p>
        </div>
        <div class="col-md-6">
          <div class="d-flex flex-column gap-2">
            <div class="d-flex align-items-center">
              <i class="fas fa-envelope me-2 text-secondary"></i>
              <a href="mailto:<%= performance.inscription.candidate_brings_pianist_accompagnateur_email %>" class="text-decoration-none text-secondary">
                <%= performance.inscription.candidate_brings_pianist_accompagnateur_email %>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<%# If a pianist has been assigned by the organism to the performance, we display the pianist's information %>
<% else %>
  <% if performance&.pianist_accompagnateur.present? %>
    <div class="card mb-3 border">
      <div class="card-header bg-light">
        <div class="d-flex align-items-center">
          <%= image_tag 'icons/piano.png', alt: t('inscriptions.inscription.piano'), width: 30, class: "me-2" %>
          <h6 class="mb-0"><%= t('inscriptions.inscription.accompanying_pianist') %></h6>
        </div>
      </div>
      <div class="card-body py-2">
        <div class="row align-items-center">
          <div class="col-md-6">
            <p class="mb-1 fw-bold"><%= performance.pianist_accompagnateur.full_name %></p>
          </div>
          <div class="col-md-6">
            <div class="d-flex flex-column gap-2">
              <div class="d-flex align-items-center">
                <i class="fas fa-envelope me-2 text-secondary"></i>
                <a href="mailto:<%= performance.pianist_accompagnateur.email %>" class="text-decoration-none text-secondary">
                  <%= performance.pianist_accompagnateur.email %>
                </a>
              </div>
              <div class="d-flex align-items-center">
                <i class="fas fa-phone me-2 text-secondary"></i>
                <span><%= performance.pianist_accompagnateur.phone_number %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <div class="">
        <div class="d-flex align-items-center" style="width: fit-content;">
          <%# <%= image_tag 'icons/piano.png', alt: t('inscriptions.inscription.piano'), width: 30, class: "p-3 border bg-white" %>
          <i class="fas fa-user me-2 p-3 rounded-circle text-secondary border bg-white"></i>
          <h6 class="mb-0"><%= t('inscriptions.inscription.accompanying_pianist') %></h6>
          <span class=" badge rounded-pill text-info bg-info-secondary"><i class="fas fa-clock me-1"></i><%= t('inscriptions.inscription.pianist_assignment_pending') %></span>
        </div>

        <div class="d-flex justify-content-start gap-3 mt-2">
          <% if performance&.tour&.final_performance_submission_deadline.present? %>
            <span class=" badge rounded-pill text-info bg-info-secondary">
              <i class="fas fa-calendar-alt me-1"></i>
              <%= t('inscriptions.inscription.pianist_assignment_date', date: l(performance.tour.final_performance_submission_deadline, format: :long)) %>
            </span>
          <% end %>
        </div>
        <small class="mb-0 text-secondary"><%= t('inscriptions.inscription.pianist_assignment_explanation') %></small>
    </div>
  <% end %>

  <%# Upload scores for pianist accompanist %>
  <% if performance.present? %>
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title mb-3"> <i class="fas fa-music me-2"></i> <%= t('.scores_section') %> </h5>

        <% if performance.present? && performance&.scores&.attached? %>
          <div class="row g-3 mb-4">
            <% performance&.scores&.each do |score| %>
              <div class="col-md-4">
                <div class="border rounded p-2 position-relative">
                  <%# Preview %>
                  <% if score.content_type.include?('pdf') %>
                    <div class="text-center mb-2">
                      <i class="fas fa-file-pdf fa-3x text-danger"></i>
                    </div>
                  <% else %>
                    <%= image_tag score, class: "img-fluid mb-2" %>
                  <% end %>

                  <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">
                      <%= score.filename.to_s %>
                    </small>
                    <div class="btn-group">
                      <%= link_to rails_blob_path(score, disposition: 'attachment'),
                                class: "btn btn-sm btn-outline-primary",
                                title: t('.download') do %>
                        <i class="fas fa-download"></i>
                      <% end %>

                      <%= button_to delete_score_performance_path(performance, score_id: score),
                                  method: :delete,
                                  class: "btn btn-sm btn-outline-danger",
                                  title: t('.delete'),
                                  data: { turbo_confirm: t('global.confirmations.are_you_sure') } do %>
                        <i class="fas fa-trash"></i>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>

        <% if performance.present? && performance&.scores&.count < 10 %>
          <%= form_with url: upload_scores_performance_path(performance),
                        method: :post,
                        class: "dropzone-form",
                        html: { multipart: true } do |form| %>
            <div class="upload-zone p-4 border rounded text-center">
              <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
              <div class="mb-3">
                <%= form.file_field :scores,
                                  multiple: true,
                                  class: "form-control",
                                  accept: ".pdf,.jpg,.jpeg,.png",
                                  data: {
                                    max_files: 10 - performance&.scores&.count
                                  } %>
              </div>
              <small class="text-muted d-block mb-3">
                <%= t('.upload_hint', count: 10 - performance&.scores&.count) %>
              </small>
              <%= form.submit t('.upload_scores'), class: "btn btn-primary" %>
            </div>
          <% end %>
        <% else %>
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <%= t('.max_files_reached') %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
